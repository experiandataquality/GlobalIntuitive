/*! contact-data-services.js | https://github.com/experiandataquality/RealTimeAddress | Apache-2.0
*   Experian Data Quality | https://github.com/experiandataquality */
!function(a,b,c){"use strict";var d=a.ContactDataServices=a.ContactDataServices||{};d.addressTemplates={"default":'<div class="toggle">{addressLine1}</div><div class="toggle">{addressLine2}</div><div class="toggle">{addressLine3}</div><div class="toggle">{locality}</div><div class="toggle">{province}</div><div class="toggle">{postalCode}</div><div class="toggle">{country}</div>',aus:'<div class="toggle">{addressLine1}</div><div class="toggle">{addressLine2}</div><div class="toggle">{addressLine3}</div><div class="toggle">{locality} {provinceCode} {postalCode}</div><div class="toggle">{country}</div>',fra:'<div class="toggle">{addressLine1}</div><div class="toggle">{addressLine2}</div><div class="toggle">{addressLine3}</div><div class="toggle">{postalCode} {locality}</div><div class="toggle">{country}</div>',gbr:'<div class="toggle">{addressLine1}</div><div class="toggle">{addressLine2}</div><div class="toggle">{addressLine3}</div><div class="toggle">{locality}</div><div class="toggle">{province}</div><div class="toggle">{postalCode}</div><div class="toggle">{country}</div>',nzl:'<div class="toggle">{addressLine1}</div><div class="toggle">{addressLine2}</div><div class="toggle">{addressLine3}</div><div class="toggle">{locality} {postalCode}</div><div class="toggle">{country}</div>',usa:'<div class="toggle">{addressLine1}</div><div class="toggle">{addressLine2}</div><div class="toggle">{addressLine3}</div><div class="toggle">{locality} {province} {postalCode}</div><div class="toggle">{country}</div>'},d.defaults={input:{placeholderText:"Start typing an address"},formattedAddress:{headingType:"h3",headingText:"Validated address"},editAddressText:"Edit address",searchAgainText:"Search again",useAddressEnteredText:"<em>Enter address manually</em>",useSpinner:!1,language:"en",addressLineLabels:["addressLine1","addressLine2","addressLine3","locality","province","postalCode","country"]},d.eventFactory=function(){var a={};return a.collection={},a.on=function(b,c){a.collection[b]=a.collection[b]||[],a.collection[b].push(c)},a.trigger=function(b,c){if(a.collection[b])for(var d=0;d<a.collection[b].length;d++){for(var e=[c],f=2;f<arguments.length;f++)e.push(arguments[f]);a.collection[b][d].apply(a.collection,e)}},a},d.translations={en:{gbr:{locality:"Town/City",province:"County",postalCode:"Post code"},usa:{locality:"City",province:"State",postalCode:"Zip code"}}},d.ua={banner:{show:function(a){var c=b.querySelector(".ua-banner");if(!c){var d=b.querySelector("body").firstChild;c=b.createElement("div"),c.classList.add("ua-banner"),d.parentNode.insertBefore(c,d.nextSibling)}c.innerHTML=a},hide:function(){var a=b.querySelector(".ua-banner");a&&a.parentNode.removeChild(a)}}},d.urls={endpoint:"https://api.edq.com/capture/address/v2/search",construct:{address:{search:function(a){var b=d.urls.endpoint;return b+="?query="+encodeURIComponent(a.currentSearchTerm),b+="&country="+a.currentCountryCode,b+="&take="+(a.maxSize||a.picklist.maxSize),b+="&auth-token="+a.token},format:function(a,b){return a+"&auth-token="+b.token}}},getToken:function(a){a.token||(a.token=d.urls.getParameter("token"))},getParameter:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}},d.address=function(e){var f=e||{};return f.enabled=!0,f.language=f.language||d.defaults.language,f.useSpinner=f.useSpinner||d.defaults.useSpinner,f.lastSearchTerm="",f.currentSearchTerm="",f.lastCountryCode="",f.currentCountryCode="",f.currentSearchUrl="",f.currentFormatUrl="",f.placeholderText=f.placeholderText||d.defaults.input.placeholderText,f.editAddressText=f.editAddressText||d.defaults.editAddressText,f.searchAgainText=f.searchAgainText||d.defaults.searchAgainText,f.formattedAddress=f.formattedAddress||d.defaults.formattedAddress,f.elements=f.elements||{},f.events=new d.eventFactory,f.init=function(){return d.urls.getToken(f),f.token?(f.setCountryList(),void(f.elements.input&&(f.input=f.elements.input,f.input.addEventListener("keyup",f.search),f.input.setAttribute("placeholder",f.placeholderText),f.input.parentNode.setAttribute("autocomplete","off"),f.input.parentNode.addEventListener("submit",function(a){a.preventDefault()}),f.input.focus()))):(f.enabled=!1,void d.ua.banner.show("<a href='https://github.com/experiandataquality/RealTimeAddress#tokens'>Please provide a token for RealTimeAddress.</a>"))},f.search=function(b){var c=b||a.event;if(c=c.which||c.keyCode,38===c||40===c||13===c)return void f.picklist.keyup(c);if(f.currentSearchTerm=f.input.value,f.currentCountryCode=f.countryList.value,f.canSearch()){f.request.currentRequest&&f.request.currentRequest.abort(),f.events.trigger("pre-search",f.currentSearchTerm);var e=d.urls.construct.address.search(f);f.lastSearchTerm=f.currentSearchTerm,f.result.hide(),f.searchSpinner.hide(),f.searchSpinner.show(),f.request.get(e,f.picklist.show)}else f.lastSearchTerm!==f.currentSearchTerm&&f.picklist.hide()},f.setCountryList=function(){f.countryList=f.elements.countryList,f.countryList||f.createCountryDropdown()},f.canSearch=function(){return f.enabled&&""!==f.currentSearchTerm&&f.lastSearchTerm!==f.currentSearchTerm&&f.countryList.value!==c&&""!==f.countryList.value},f.createCountryDropdown=function(){f.countryList={}},f.format=function(a){f.events.trigger("pre-formatting-search",a),f.searchSpinner.hide(),f.currentFormatUrl=d.urls.construct.address.format(a,f),f.request.get(f.currentFormatUrl,f.result.show)},f.picklist={size:0,maxSize:25,show:function(a){f.picklist.items=a.results,f.picklist.currentItem=null,f.picklist.size=f.picklist.items.length,f.picklist.container=f.picklist.container||f.picklist.createList(),f.picklist.container.innerHTML="",f.picklist.resetTabCount(),f.searchSpinner.hide(),f.picklist.useAddressEntered.element=f.picklist.useAddressEntered.element||f.picklist.useAddressEntered.create(),f.picklist.size>0&&(f.events.trigger("pre-picklist-create",f.picklist.items),f.picklist.items.forEach(function(a){var b=f.picklist.createListItem(a);f.picklist.container.appendChild(b),f.picklist.listen(b)}),f.events.trigger("post-picklist-create"))},hide:function(){f.picklist.currentItem=null,f.picklist.useAddressEntered.destroy(),f.picklist.container&&(f.input.parentNode.removeChild(f.picklist.container),f.picklist.container=c)},useAddressEntered:{create:function(){var a={suggestion:d.defaults.useAddressEnteredText,format:""},b=f.picklist.createListItem(a);return b.classList.add("use-address-entered"),f.picklist.container.parentNode.insertBefore(b,f.picklist.container.nextSibling),b.addEventListener("click",f.picklist.useAddressEntered.click),b},destroy:function(){f.picklist.useAddressEntered.element&&(f.picklist.container.parentNode.removeChild(f.picklist.useAddressEntered.element),f.picklist.useAddressEntered.element=c)},click:function(){var a={address:[]};if(f.currentSearchTerm){var b=f.currentSearchTerm.split(",");if(b.length>0)for(var c=0;c<b.length;c++)a.address.push(f.picklist.useAddressEntered.formatManualAddressLine(b,c));var d=7,e=d-b.length;if(e>0)for(var g=d-e,h=g;d>h;h++)a.address.push(f.picklist.useAddressEntered.formatManualAddressLine([],h))}f.result.show(a),f.result.editAddressManually()},formatManualAddressLine:function(a,b){var c=d.defaults.addressLineLabels[b],e={};return e[c]=a[b]||"",e}},createList:function(){var a=b.createElement("div");return a.classList.add("address-picklist"),f.input.parentNode.insertBefore(a,f.input.nextSibling),a.addEventListener("keydown",f.picklist.enter),a},createListItem:function(a){var c=b.createElement("div");return c.innerHTML=f.picklist.addMatchingEmphasis(a),c.setAttribute("format",a.format),c},tabCount:-1,resetTabCount:function(){f.picklist.tabCount=-1},keyup:function(a){if(f.picklist.container){if(13===a)return void f.picklist.checkEnter();var b,c,d=f.picklist.container.querySelectorAll("div");38===a?f.picklist.tabCount--:f.picklist.tabCount++,f.picklist.tabCount<0&&(f.picklist.tabCount=d.length-1,c=!0),f.picklist.tabCount>d.length-1&&(f.picklist.tabCount=0,b=!0);var e=d[f.picklist.tabCount],g=f.picklist.container.querySelector(".selected");g&&g.classList.remove("selected"),e.classList.add("selected"),f.picklist.currentItem=e;var h={top:f.picklist.container.offsetTop,bottom:f.picklist.container.offsetTop+f.picklist.container.offsetHeight,scrollTop:f.picklist.container.scrollTop,selectedTop:e.offsetTop,selectedBottom:e.offsetTop+e.offsetHeight,scrollAmount:e.offsetHeight};b?f.picklist.container.scrollTop=0:c?f.picklist.container.scrollTop=999:h.selectedBottom+h.scrollAmount>h.bottom?f.picklist.container.scrollTop=h.scrollTop+h.scrollAmount:h.selectedTop-h.scrollAmount-h.top<h.scrollTop&&(f.picklist.container.scrollTop=h.scrollTop-h.scrollAmount)}},addMatchingEmphasis:function(a){for(var b=a.matched||[],c=a.suggestion,d=0;d<b.length;d++){var e="<b>"+c.substring(b[d][0],b[d][1])+"</b>";c=c.substring(0,b[d][0])+e+c.substring(b[d][1])}return c},listen:function(a){a.addEventListener("click",f.picklist.pick.bind(null,a))},checkEnter:function(){var a;1===f.picklist.size?a=f.picklist.container.querySelectorAll("div")[0]:f.picklist.currentItem&&(a=f.picklist.currentItem),a&&f.picklist.pick(a)},pick:function(a){f.events.trigger("post-picklist-selection",a),f.format(a.getAttribute("format"))}},f.result={show:function(a){if(f.searchSpinner.hide(),f.picklist.hide(),f.input.value="",a.address.length>0){f.events.trigger("post-formatting-search",a),f.result.formattedAddress=f.elements.formattedAddress||f.result.createFormattedAddressContainer();for(var b=[],c=d.addressTemplates.hasOwnProperty(f.currentCountryCode)?f.currentCountryCode:"default",e=d.addressTemplates[c],g=0;g<a.address.length;g++){var h=a.address[g];for(var i in h)if(h.hasOwnProperty(i)){e=e.replace("{"+i+"}",h[i]);var j=f.result.createAddressLine.label(i);b.push(f.result.createAddressLine.input(j,h[i]))}}e=e.replace(/{.*}/,""),f.result.formattedAddress.innerHTML+=e,f.result.renderInputList(b),f.result.createEditAddressLink(),f.result.createSearchAgainLink()}},hide:function(){f.result.formattedAddress&&(f.input.parentNode.removeChild(f.result.formattedAddress),f.result.formattedAddress=c)},createFormattedAddressContainer:function(){var a=b.createElement("div");if(a.classList.add("formatted-address"),f.formattedAddress.heading!==!1){var c=b.createElement(f.formattedAddress.headingType);c.innerHTML=f.formattedAddress.headingText,a.appendChild(c)}return f.input.parentNode.insertBefore(a,f.input.nextSibling),a},createAddressLine:{input:function(a,c){var d=b.createElement("div");d.classList.add("hidden"),d.classList.add("address-line-input");var e=b.createElement("label");e.innerHTML=a.replace(/([A-Z])/g," $1").replace(/([0-9])/g," $1").replace(/^./,function(a){return a.toUpperCase()}),d.appendChild(e);var f=b.createElement("input");return f.setAttribute("type","text"),f.setAttribute("name",a),f.setAttribute("value",c),d.appendChild(f),d},row:function(a){var c=b.createElement("div");return c.classList.add("toggle"),c.innerHTML=a,c},label:function(a){var b=a,c=f.language,e=f.currentCountryCode,g=d.translations;if(g)try{var h=g[c][e][a];h&&(b=h)}catch(i){}return b}},createEditAddressLink:function(){var a=b.createElement("a");a.setAttribute("href","#"),a.classList.add("edit-address-link"),a.innerHTML=f.editAddressText,f.result.formattedAddress.appendChild(a),a.addEventListener("click",f.result.editAddressManually)},createSearchAgainLink:function(){var a=b.createElement("a");a.setAttribute("href","#"),a.classList.add("search-again-link"),a.innerHTML=f.searchAgainText,f.result.formattedAddress.appendChild(a),a.addEventListener("click",f.reset)},editAddressManually:function(a){a&&a.preventDefault(),f.result.formattedAddress.querySelector(".edit-address-link").classList.add("hidden"),f.toggleVisibility(f.result.formattedAddress);for(var b=f.result.formattedAddress.querySelectorAll(".address-line-input"),c=0;c<b.length;c++)b[c].classList.remove("hidden")},renderInputList:function(a){if(a.length>0)for(var b=0;b<a.length;b++)f.result.formattedAddress.appendChild(a[b])}},f.toggleVisibility=function(a){a=a||b;for(var c=a.querySelectorAll(".toggle"),d=0;d<c.length;d++)c[d].classList.contains("hidden")?c[d].classList.remove("hidden"):c[d].classList.add("hidden")},f.searchSpinner={show:function(){if(f.useSpinner){var a=b.createElement("div");a.classList.add("loader"),a.classList.add("loader-inline");var c=b.createElement("div");c.classList.add("spinner"),a.appendChild(c),f.input.parentNode.insertBefore(a,f.input.nextSibling)}},hide:function(){if(f.useSpinner){var a=f.input.parentNode.querySelector(".loader-inline");a&&f.input.parentNode.removeChild(a)}}},f.reset=function(a){a&&a.preventDefault(),f.enabled=!0,f.result.hide(),f.toggleVisibility(f.input.parentNode),f.input.focus(),f.events.trigger("post-reset")},f.handleError={badRequest:function(a){f.enabled=!1,f.handleError.showSubmitButton(),f.events.trigger("request-error-400",a)},unauthorized:function(a){f.enabled=!1,f.handleError.showSubmitButton(),f.events.trigger("request-error-401",a)},forbidden:function(a){f.enabled=!1,f.handleError.showSubmitButton(),f.events.trigger("request-error-403",a)},notFound:function(a){f.enabled=!1,f.handleError.showSubmitButton(),f.events.trigger("request-error-404",a)},showSubmitButton:function(){var a=b.createElement("button");a.innerText="Submit",f.input.parentNode.insertBefore(a,f.input.nextSibling),a.addEventListener("click",function(){f.picklist.useAddressEntered.click(),f.input.parentNode.removeChild(a)})}},f.request={currentRequest:null,get:function(a,b){f.request.currentRequest=new XMLHttpRequest,f.request.currentRequest.open("GET",a,!0),f.request.currentRequest.timeout=5e3,f.request.currentRequest.onload=function(a){if(f.request.currentRequest.status>=200&&f.request.currentRequest.status<400){var c=JSON.parse(f.request.currentRequest.responseText);b(c)}else f.searchSpinner.hide(),f.events.trigger("request-error",a),400===f.request.currentRequest.status?f.handleError.badRequest(a):401===f.request.currentRequest.status?f.handleError.unauthorized(a):403===f.request.currentRequest.status?f.handleError.forbidden(a):404===f.request.currentRequest.status&&f.handleError.notFound(a)},f.request.currentRequest.onerror=function(a){f.searchSpinner.hide(),f.events.trigger("request-error",a)},f.request.currentRequest.ontimeout=function(a){f.searchSpinner.hide(),f.events.trigger("request-timeout",a)},f.request.currentRequest.send()}},f.init(),f}}(window,window.document);