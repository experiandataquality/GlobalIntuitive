/*! contact-data-services.js | https://github.com/experiandataquality/GlobalIntuitive | Apache-2.0
*   Experian Data Quality | https://github.com/experiandataquality */

!function(e,t,r){"use strict";var n=e.ContactDataServices=e.ContactDataServices||{};n.defaults={input:{placeholderText:"Start typing an address...",applyFocus:!1},formattedAddressContainer:{showHeading:!1,headingType:"h3",validatedHeadingText:"Validated address",manualHeadingText:"Manual address entered"},searchAgain:{visible:!0,text:"Search again"},useAddressEnteredText:"<em>Enter address manually</em>",useSpinner:!1,language:"en",addressLineLabels:["addressLine1","addressLine2","addressLine3","locality","province","postalCode","country"]},n.mergeDefaultOptions=function(e){var t=e||{};return t.enabled=!0,t.language=t.language||n.defaults.language,t.useSpinner=t.useSpinner||n.defaults.useSpinner,t.lastSearchTerm="",t.currentSearchTerm="",t.lastCountryCode="",t.currentCountryCode="",t.currentSearchUrl="",t.currentFormatUrl="",t.applyFocus=void 0!==t.applyFocus?t.applyFocus:n.defaults.input.applyFocus,t.placeholderText=t.placeholderText||n.defaults.input.placeholderText,t.searchAgain=t.searchAgain||{},t.searchAgain.visible=void 0!==t.searchAgain.visible?t.searchAgain.visible:n.defaults.searchAgain.visible,t.searchAgain.text=t.searchAgain.text||n.defaults.searchAgain.text,t.formattedAddressContainer=t.formattedAddressContainer||n.defaults.formattedAddressContainer,t.formattedAddressContainer.showHeading=void 0!==t.formattedAddressContainer.showHeading?t.formattedAddressContainer.showHeading:n.defaults.formattedAddressContainer.showHeading,t.formattedAddressContainer.headingType=t.formattedAddressContainer.headingType||n.defaults.formattedAddressContainer.headingType,t.formattedAddressContainer.validatedHeadingText=t.formattedAddressContainer.validatedHeadingText||n.defaults.formattedAddressContainer.validatedHeadingText,t.formattedAddressContainer.manualHeadingText=t.formattedAddressContainer.manualHeadingText||n.defaults.formattedAddressContainer.manualHeadingText,t.elements=t.elements||{},t},n.eventFactory=function(){var e={};return e.collection={},e.on=function(t,r){e.collection[t]=e.collection[t]||[],e.collection[t].push(r)},e.trigger=function(t,r){if(e.collection[t])for(var n=0;n<e.collection[t].length;n++){for(var s=[r],i=2;i<arguments.length;i++)s.push(arguments[i]);try{e.collection[t][n].apply(e.collection,s)}catch(e){}}},e},n.translations={en:{gbr:{locality:"Town/City",province:"County",postalCode:"Post code"},usa:{locality:"City",province:"State",postalCode:"Zip code"}}},n.ua={banner:{show:function(e){var r=t.querySelector(".ua-banner");if(!r){var n=t.querySelector("body").firstChild;(r=t.createElement("div")).classList.add("ua-banner"),n.parentNode.insertBefore(r,n.nextSibling)}r.innerHTML=e},hide:function(){var e=t.querySelector(".ua-banner");e&&e.parentNode.removeChild(e)}}},n.urls={endpoint:"https://api.edq.com/capture/address/v2/search",construct:{address:{search:function(e){var t=n.urls.endpoint;return t+="?query="+encodeURIComponent(e.currentSearchTerm),t+="&country="+e.currentCountryCode,t+="&take="+(e.maxSize||e.picklist.maxSize),t+="&auth-token="+e.token},format:function(e,t){return e+"&auth-token="+t.token}}},getToken:function(e){e.token||(e.token=n.urls.getParameter("token"))},getParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}},n.address=function(s){var i=n.mergeDefaultOptions(s);return i.events=new n.eventFactory,i.init=function(){if(n.urls.getToken(i),!i.token)return i.enabled=!1,void n.ua.banner.show("<a href='https://github.com/experiandataquality/GlobalIntuitive#tokens'>Please provide a token for GlobalIntuitive.</a>");i.hasSearchInputBeenReset=!0,i.setCountryList(),i.elements.input&&(i.input=i.elements.input,i.input.addEventListener("keyup",i.search),i.input.addEventListener("keydown",i.checkTab),i.input.setAttribute("placeholder",i.placeholderText),i.input.parentNode.setAttribute("autocomplete","off"),i.input.parentNode.addEventListener("submit",function(e){e.preventDefault()}),i.applyFocus&&i.input.focus())},i.unbind=function(){i.elements.input&&(i.input=i.elements.input,i.input.removeEventListener("keyup",i.search),i.input.removeEventListener("keydown",i.checkTab),i.input.parentNode.removeAttribute("autocomplete"))},i.search=function(t){var r=t||e.event;if(38!==(r=r.which||r.keyCode)&&40!==r&&13!==r)if(i.currentSearchTerm=i.input.value,i.currentCountryCode=i.countryList.value,""===i.currentSearchTerm&&(i.hasSearchInputBeenReset=!0),i.canSearch()){i.request.currentRequest&&i.request.currentRequest.abort(),i.events.trigger("pre-search",i.currentSearchTerm);var s=n.urls.construct.address.search(i);i.lastSearchTerm=i.currentSearchTerm,i.result.hide(),i.searchSpinner.hide(),i.searchSpinner.show(),i.request.get(s,i.picklist.show)}else i.lastSearchTerm!==i.currentSearchTerm&&i.picklist.hide();else i.picklist.keyup(r)},i.setCountryList=function(){i.countryList=i.elements.countryList,i.countryList||i.createCountryDropdown()},i.canSearch=function(){return i.enabled&&""!==i.currentSearchTerm&&i.lastSearchTerm!==i.currentSearchTerm&&i.countryList.value!==r&&""!==i.countryList.value&&!0===i.hasSearchInputBeenReset},i.checkTab=function(t){var r=t||e.event;9!==(r=r.which||r.keyCode)||i.picklist.keyup(r)},i.createCountryDropdown=function(){i.countryList={}},i.format=function(e){i.events.trigger("pre-formatting-search",e),i.searchSpinner.hide(),i.currentFormatUrl=n.urls.construct.address.format(e,i),i.request.get(i.currentFormatUrl,i.result.show)},i.picklist={size:0,maxSize:25,show:function(e){i.picklist.items=e.results,i.picklist.currentItem=null,i.picklist.size=i.picklist.items.length,i.picklist.list=i.picklist.list||i.picklist.createList(),i.picklist.list.innerHTML="",i.picklist.resetTabCount(),i.searchSpinner.hide(),i.picklist.useAddressEntered.element=i.picklist.useAddressEntered.element||i.picklist.useAddressEntered.create(),i.picklist.size>0&&(i.events.trigger("pre-picklist-create",i.picklist.items),i.picklist.items.forEach(function(e){var t=i.picklist.createListItem(e);i.picklist.list.appendChild(t),i.picklist.listen(t)}),i.events.trigger("post-picklist-create"))},hide:function(){i.picklist.currentItem=null,i.picklist.useAddressEntered.destroy(),i.picklist.list&&(i.input.parentNode.removeChild(i.picklist.container),i.picklist.list=r)},useAddressEntered:{create:function(){var e={suggestion:n.defaults.useAddressEnteredText,format:""},t=i.picklist.createListItem(e);return t.classList.add("use-address-entered"),i.picklist.list.parentNode.insertBefore(t,i.picklist.list.nextSibling),t.addEventListener("click",i.picklist.useAddressEntered.click),t},destroy:function(){i.picklist.useAddressEntered.element&&(i.picklist.list.parentNode.removeChild(i.picklist.useAddressEntered.element),i.picklist.useAddressEntered.element=r)},click:function(){var e={address:[]};if(i.currentSearchTerm){var t=i.currentSearchTerm.split(",");if(t.length>0)for(var r=0;r<t.length;r++)e.address.push(i.picklist.useAddressEntered.formatManualAddressLine(t,r));var n=7-t.length;if(n>0)for(var s=7-n;s<7;s++)e.address.push(i.picklist.useAddressEntered.formatManualAddressLine([],s))}i.result.show(e),i.result.updateHeading(i.formattedAddressContainer.manualHeadingText)},formatManualAddressLine:function(e,t){var r={};return r[n.defaults.addressLineLabels[t]]=e[t]||"",r}},createList:function(){var e=t.createElement("div");e.classList.add("address-picklist-container"),i.input.parentNode.insertBefore(e,i.input.nextSibling),i.picklist.container=e;var r=t.createElement("div");return r.classList.add("address-picklist"),e.appendChild(r),r.addEventListener("keydown",i.picklist.enter),r},createListItem:function(e){var r=t.createElement("div");return r.innerHTML=i.picklist.addMatchingEmphasis(e),r.setAttribute("format",e.format),r},tabCount:-1,resetTabCount:function(){i.picklist.tabCount=-1},keyup:function(e){if(i.picklist.list)if(13!==e&&9!==e){var t,r,n=i.picklist.list.querySelectorAll("div");if(0!==n.length){38===e?i.picklist.tabCount--:i.picklist.tabCount++,i.picklist.tabCount<0&&(i.picklist.tabCount=n.length-1,r=!0),i.picklist.tabCount>n.length-1&&(i.picklist.tabCount=0,t=!0);var s=n[i.picklist.tabCount],a=i.picklist.list.querySelector(".selected");a&&a.classList.remove("selected"),s.classList.add("selected"),i.picklist.currentItem=s;var d=i.picklist.list.offsetTop,l=i.picklist.list.offsetTop+i.picklist.list.offsetHeight,o=i.picklist.list.scrollTop,u=s.offsetTop,c=s.offsetTop+s.offsetHeight,p=s.offsetHeight;t?i.picklist.list.scrollTop=0:r?i.picklist.list.scrollTop=999:c+p>l?i.picklist.list.scrollTop=o+p:u-p-d<o&&(i.picklist.list.scrollTop=o-p)}}else i.picklist.checkEnter()},addMatchingEmphasis:function(e){for(var t=e.matched||[],r=e.suggestion,n=0;n<t.length;n++){var s="<b>"+r.substring(t[n][0],t[n][1])+"</b>";r=r.substring(0,t[n][0])+s+r.substring(t[n][1])}return r},listen:function(e){e.addEventListener("click",i.picklist.pick.bind(null,e))},checkEnter:function(){var e;1===i.picklist.size?e=i.picklist.list.querySelectorAll("div")[0]:i.picklist.currentItem&&(e=i.picklist.currentItem),e&&i.picklist.pick(e)},pick:function(e){i.events.trigger("post-picklist-selection",e),i.format(e.getAttribute("format"))}},i.result={show:function(e){if(i.searchSpinner.hide(),i.picklist.hide(),i.input.value="",i.events.trigger("post-formatting-search",e),e.address&&e.address.length>0){i.result.calculateIfAddressLineGenerationRequired(),i.result.formattedAddressContainer=i.elements.formattedAddressContainer,!i.result.formattedAddressContainer&&i.result.generateAddressLineRequired&&i.result.createFormattedAddressContainer();for(var t=0;t<e.address.length;t++){var r=e.address[t];for(var n in r)r.hasOwnProperty(n)&&i.result.updateAddressLine(n,r)}i.result.hideSearchInputs(),i.result.createSearchAgainLink();for(var s in i.elements)if(i.elements.hasOwnProperty(s)&&"input"!==s&&i.elements[s]===i.elements.input){i.hasSearchInputBeenReset=!1;break}}},hide:function(){i.result.formattedAddressContainer&&(i.input.parentNode.removeChild(i.result.formattedAddressContainer),i.result.formattedAddressContainer=r),i.searchAgain.link&&(i.searchAgain.link.parentNode.removeChild(i.searchAgain.link),i.searchAgain.link=r);for(var e in i.elements)if(i.elements.hasOwnProperty(e))for(var t=0;t<n.defaults.addressLineLabels.length;t++){if(n.defaults.addressLineLabels[t]===e&&i.elements[e]!==i.elements.input){i.elements[e].value="";break}}},createFormattedAddressContainer:function(){var e=t.createElement("div");e.classList.add("formatted-address"),i.input.parentNode.insertBefore(e,i.input.nextSibling),i.result.formattedAddressContainer=e},createHeading:function(){if(i.formattedAddressContainer.showHeading){var e=t.createElement(i.formattedAddressContainer.headingType);e.innerHTML=i.formattedAddressContainer.validatedHeadingText,i.result.formattedAddressContainer.appendChild(e)}},updateHeading:function(e){i.formattedAddressContainer.showHeading&&(i.result.formattedAddressContainer.querySelector(i.formattedAddressContainer.headingType).innerHTML=e)},calculateIfAddressLineGenerationRequired:function(){i.result.generateAddressLineRequired=!0;for(var e=0;e<n.defaults.addressLineLabels.length;e++){var t=n.defaults.addressLineLabels[e];if(i.elements[t]){i.result.generateAddressLineRequired=!1;break}}},updateAddressLine:function(e,t){if(i.elements[e]){var r=i.elements[e],n=t[e];r.value&&n&&(n=", "+n),r.value+=n,i.result.lastAddressField=r}else if(i.result.generateAddressLineRequired){var s=i.result.createAddressLine.label(e),a=i.result.createAddressLine.input(s,t[e]);i.result.formattedAddressContainer.appendChild(a)}},createAddressLine:{input:function(e,r){var n=t.createElement("div");n.classList.add("address-line-input");var s=t.createElement("label");s.innerHTML=e.replace(/([A-Z])/g," $1").replace(/([0-9])/g," $1").replace(/^./,function(e){return e.toUpperCase()}),n.appendChild(s);var i=t.createElement("input");return i.setAttribute("type","text"),i.setAttribute("name",e),i.setAttribute("value",r),n.appendChild(i),n},label:function(e){var t=e,r=i.language.toLowerCase(),s=i.currentCountryCode.toLowerCase(),a=n.translations;if(a)try{var d=a[r][s][e];d&&(t=d)}catch(e){}return t}},createSearchAgainLink:function(){if(i.searchAgain.visible){var e=t.createElement("a");e.setAttribute("href","#"),e.classList.add("search-again-link"),e.innerHTML=i.searchAgain.text,e.addEventListener("click",i.reset),i.searchAgain.link=e,i.result.formattedAddressContainer?i.result.formattedAddressContainer.appendChild(e):i.result.lastAddressField.parentNode.insertBefore(e,i.result.lastAddressField.nextSibling)}},renderInputList:function(e){if(e.length>0)for(var t=0;t<e.length;t++)i.result.formattedAddressContainer.appendChild(e[t])},hideSearchInputs:function(){i.toggleVisibility(i.input.parentNode)}},i.toggleVisibility=function(e){for(var r=(e=e||t).querySelectorAll(".toggle"),n=0;n<r.length;n++)r[n].classList.contains("hidden")?r[n].classList.remove("hidden"):r[n].classList.add("hidden")},i.searchSpinner={show:function(){if(i.useSpinner){var e=t.createElement("div");e.classList.add("loader"),e.classList.add("loader-inline");var r=t.createElement("div");r.classList.add("spinner"),e.appendChild(r),i.input.parentNode.insertBefore(e,i.input.nextSibling)}},hide:function(){if(i.useSpinner){var e=i.input.parentNode.querySelector(".loader-inline");e&&i.input.parentNode.removeChild(e)}}},i.reset=function(e){e&&e.preventDefault(),i.enabled=!0,i.result.hide(),i.input.value="",i.hasSearchInputBeenReset=!0,i.toggleVisibility(i.input.parentNode),i.input.focus(),i.events.trigger("post-reset")},i.handleError={badRequest:function(e){i.enabled=!1,i.handleError.showSubmitButton(),i.events.trigger("request-error-400",e)},unauthorized:function(e){i.enabled=!1,i.handleError.showSubmitButton(),i.events.trigger("request-error-401",e)},forbidden:function(e){i.enabled=!1,i.handleError.showSubmitButton(),i.events.trigger("request-error-403",e)},notFound:function(e){i.enabled=!1,i.handleError.showSubmitButton(),i.events.trigger("request-error-404",e)},showSubmitButton:function(){var e=t.createElement("button");e.innerText="Submit",i.input.parentNode.insertBefore(e,i.input.nextSibling),e.addEventListener("click",function(){i.picklist.useAddressEntered.click(),i.input.parentNode.removeChild(e)})}},i.request={currentRequest:null,get:function(e,t){i.request.currentRequest=new XMLHttpRequest,i.request.currentRequest.open("GET",e,!0),i.request.currentRequest.timeout=5e3,i.request.currentRequest.onload=function(e){if(i.request.currentRequest.status>=200&&i.request.currentRequest.status<400){var r=JSON.parse(i.request.currentRequest.responseText);t(r)}else i.searchSpinner.hide(),i.events.trigger("request-error",e),400===i.request.currentRequest.status?i.handleError.badRequest(e):401===i.request.currentRequest.status?i.handleError.unauthorized(e):403===i.request.currentRequest.status?i.handleError.forbidden(e):404===i.request.currentRequest.status&&i.handleError.notFound(e)},i.request.currentRequest.onerror=function(e){i.searchSpinner.hide(),i.events.trigger("request-error",e)},i.request.currentRequest.ontimeout=function(e){i.searchSpinner.hide(),i.events.trigger("request-timeout",e)},i.request.currentRequest.send()}},i.init(),i}}(window,window.document);